<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>IOT-FARM</title>
		<meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
		<script src="https://code.highcharts.com/stock/highstock.js"></script>
		<script src="https://code.highcharts.com/stock/modules/exporting.js"></script>
		

	</head>

	<body class="skin-blue sidebar-collapse sidebar-mini">
		<script src="https://code.jquery.com/jquery-2.2.4.min.js" ></script>
		<script src="https://cdn.socket.io/socket.io-1.0.0.js"></script>
		<div id="refresh">Refresh</div>
		<div id="container" style="height: 400px; min-width: 310px"></div>
		<script language="JavaScript">
		
			$(document).ready(function() {
				console.log('HTML: Ready');
				var j=0;
				var address = "192.168.0.21:5001"
	            console.log('HTML: attempting to connect to robot');
	            console.log('@' + address);
	            socket = io.connect(address);
	            var lesdatas = [];
	            socket.emit('get-humidity-sensor');
	            
				socket.on("humidity-sensor", function(data) {
	            	 console.log(data.data);
	            	lesdatas[j] = jQuery.parseJSON(data.data);
	            	
	            	j++;
				});
				
				$('#refresh').on('mousedown', function(){
		            console.log("emission de refresh");
		            socket.emit('get-humidity-sensor');
		        });
		        
		        setTimeout(function () {
				    Highcharts.setOptions({
				        global: {
				            useUTC: false
				        }
				    });
				    // Create the chart
				    Highcharts.stockChart('container', {
				        chart: {
				            events: {
				                /*load: function () {
				
				                    // set up the updating of the chart each second
				                    var series = this.series[0];
				                    setInterval(function () {
				                        var x = (new Date()).getTime(), // current time
				                            y = Math.round(Math.random() * 100);
				                        series.addPoint([x, y], true, true);
				                    }, 1000);
				                }*/
				            }
				        },
				
				        rangeSelector: {
				            buttons: [{
				                count: 1,
				                type: 'hour',
				                text: '1H'
				            }, {
				                count: 30,
				                type: 'minute',
				                text: '30M'
				            }, {
				                type: 'all',
				                text: 'All'
				            }],
				            inputEnabled: false,
				            selected: 0
				        },
				
				        title: {
				            text: 'Live random data'
				        },
				
				        exporting: {
				            enabled: false
				        },
				
				        series: [{
				            name: 'Random data',
				            data: (function () {
				                // generate an array of random data
				                var data = [],
				                    time = (new Date()).getTime(),
				                    i;
				                console.log("dedans"+lesdatas.length);   
				                for (i = 0; i < lesdatas.length; i = i + 1) {
				                    data.push([
				                        time = (new Date(lesdatas[i]['date'])).getTime(),
				                        lesdatas[i]['moisture']
				                        
				                    ]);
				                    console.log("---> i: "+i+" - "+lesdatas[i]['moisture']+ " - "+ time);
				                }
				                return data;
				            }())
				        }]
				    });
				
				}
		        , 1000);
				
				
		        
		        
		        
			});
		</script>
	</body>
</html>
